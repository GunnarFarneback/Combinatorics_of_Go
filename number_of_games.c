#include <stdio.h>

#define NUMBER_OF_STATES 57
#define NUMBER_OF_POINTS 4

int transformations[NUMBER_OF_STATES][2 * NUMBER_OF_POINTS] = {
{ 8,  7,  6,  5,  4,  3,  2,  1}, /*  0: .... */
{14, 13, 12, 11, 10,  9, -1, -1}, /*  1: O... */
{20, 19, 18, 17, 16, 15, -1, -1}, /*  2: X... */
{24, 23, 22, 21, 15,  9, -1, -1}, /*  3: .O.. */
{28, 27, 26, 25, 16, 10, -1, -1}, /*  4: .X.. */
{30, 29, 25, 21, 17, 11, -1, -1}, /*  5: ..O. */
{32, 31, 26, 22, 18, 12, -1, -1}, /*  6: ..X. */
{31, 29, 27, 23, 19, 13, -1, -1}, /*  7: ...O */
{32, 30, 28, 24, 20, 14, -1, -1}, /*  8: ...X */
{36, 35, 34, 33, -1, -1, -1, -1}, /*  9: OO.. */
{38, 37, 28, 11, -1, -1, -1, -1}, /* 10: OX.. */
{39, 33, -1, -1, -1, -1, -1, -1}, /* 11: O.O. */
{41, 40, 37, 34, -1, -1, -1, -1}, /* 12: O.X. */
{40, 39, 38, 35, -1, -1, -1, -1}, /* 13: O..O */
{41, 36, 28, 11, -1, -1, -1, -1}, /* 14: O..X */
{43, 42, 23, 18, -1, -1, -1, -1}, /* 15: XO.. */
{47, 46, 45, 44, -1, -1, -1, -1}, /* 16: XX.. */
{49, 48, 44, 42, -1, -1, -1, -1}, /* 17: X.O. */
{50, 45, -1, -1, -1, -1, -1, -1}, /* 18: X.X. */
{48, 46, 23, 18, -1, -1, -1, -1}, /* 19: X..O */
{50, 49, 47, 43, -1, -1, -1, -1}, /* 20: X..X */
{52, 51, 42, 33, -1, -1, -1, -1}, /* 21: .OO. */
{53, 34, 23, 18, -1, -1, -1, -1}, /* 22: .OX. */
{51, 35, -1, -1, -1, -1, -1, -1}, /* 23: .O.O */
{53, 52, 43, 36, -1, -1, -1, -1}, /* 24: .O.X */
{54, 44, 28, 11, -1, -1, -1, -1}, /* 25: .XO. */
{56, 55, 45, 37, -1, -1, -1, -1}, /* 26: .XX. */
{55, 54, 46, 38, -1, -1, -1, -1}, /* 27: .X.O */
{56, 47, -1, -1, -1, -1, -1, -1}, /* 28: .X.X */
{54, 51, 48, 39, -1, -1, -1, -1}, /* 29: ..OO */
{52, 49, 28, 11, -1, -1, -1, -1}, /* 30: ..OX */
{55, 40, 23, 18, -1, -1, -1, -1}, /* 31: ..XO */
{56, 53, 50, 41, -1, -1, -1, -1}, /* 32: ..XX */
{ 8,  0, -1, -1, -1, -1, -1, -1}, /* 33: OOO. */
{35, 32, -1, -1, -1, -1, -1, -1}, /* 34: OOX. */
{ 6,  0, -1, -1, -1, -1, -1, -1}, /* 35: OO.O */
{33, 32, -1, -1, -1, -1, -1, -1}, /* 36: OO.X */
{56, 13, -1, -1, -1, -1, -1, -1}, /* 37: OXX. */
{39, 26, -1, -1, -1, -1, -1, -1}, /* 38: OX.O */
{ 4,  0, -1, -1, -1, -1, -1, -1}, /* 39: O.OO */
{35, 26, -1, -1, -1, -1, -1, -1}, /* 40: O.XO */
{56,  9, -1, -1, -1, -1, -1, -1}, /* 41: O.XX */
{51, 20, -1, -1, -1, -1, -1, -1}, /* 42: XOO. */
{50, 21, -1, -1, -1, -1, -1, -1}, /* 43: XO.X */
{47, 29, -1, -1, -1, -1, -1, -1}, /* 44: XXO. */
{ 7,  0, -1, -1, -1, -1, -1, -1}, /* 45: XXX. */
{45, 29, -1, -1, -1, -1, -1, -1}, /* 46: XX.O */
{ 5,  0, -1, -1, -1, -1, -1, -1}, /* 47: XX.X */
{51, 16, -1, -1, -1, -1, -1, -1}, /* 48: X.OO */
{47, 21, -1, -1, -1, -1, -1, -1}, /* 49: X.OX */
{ 3,  0, -1, -1, -1, -1, -1, -1}, /* 50: X.XX */
{ 2,  0, -1, -1, -1, -1, -1, -1}, /* 51: .OOO */
{33, 20, -1, -1, -1, -1, -1, -1}, /* 52: .OOX */
{50,  9, -1, -1, -1, -1, -1, -1}, /* 53: .OXX */
{39, 16, -1, -1, -1, -1, -1, -1}, /* 54: .XOO */
{45, 13, -1, -1, -1, -1, -1, -1}, /* 55: .XXO */
{ 1,  0, -1, -1, -1, -1, -1, -1}, /* 56: .XXX */
};

void play_games(int state, int *visited_states, unsigned long long *n)
{
  int k;
  visited_states[state] = 1;
  (*n)++;
  for (k = 0; k < 2 * NUMBER_OF_POINTS; k++) {
    int next_state = transformations[state][k];
    if (next_state >= 0
	&& !visited_states[next_state])
      play_games(next_state, visited_states, n);
  }
  visited_states[state] = 0;
}

int main(int argc, char **argv)
{
  unsigned long long n = 0;
  int visited_states[NUMBER_OF_STATES];
  int k;

  for (k = 0; k < NUMBER_OF_STATES; k++)
    visited_states[k] = 0;

  play_games(0, visited_states, &n);
  
  printf("Number of games: %Lu\n", n);
  return 0;
}
